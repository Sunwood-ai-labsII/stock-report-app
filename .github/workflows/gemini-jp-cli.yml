name: 'ğŸ’¬ Gemini CLI (æ—¥æœ¬èªç‰ˆ)'

on:
  pull_request_review_comment:
    types:
      - 'created'
  pull_request_review:
    types:
      - 'submitted'
  issue_comment:
    types:
      - 'created'

concurrency:
  group: '${{ github.workflow }}-${{ github.event.issue.number }}'
  cancel-in-progress: |-
    ${{ github.event.sender.type == 'User' && ( github.event.issue.author_association == 'OWNER' || github.event.issue.author_association == 'MEMBER' || github.event.issue.author_association == 'COLLABORATOR') }}

defaults:
  run:
    shell: 'bash'

permissions:
  contents: 'write'
  id-token: 'write'
  pull-requests: 'write'
  issues: 'write'

jobs:
  gemini-cli-jp:
    # ã“ã®æ¡ä»¶ã¯ä¿¡é ¼ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚ŒãŸå ´åˆã®ã¿å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
    # ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä¿¡é ¼ã§ãã‚‹ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚
    # ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€ãƒ¡ãƒ³ãƒãƒ¼ã€ã‚ªãƒ¼ãƒŠãƒ¼ã€ã¾ãŸã¯ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒä¿¡é ¼ã§ãã‚‹ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚
    if: |-
      github.event_name == 'workflow_dispatch' ||
      (
        github.event_name == 'issues' && github.event.action == 'opened' &&
        contains(github.event.issue.body, '@gemini-jp-cli') &&
        !contains(github.event.issue.body, '@gemini-jp-cli /review') &&
        !contains(github.event.issue.body, '@gemini-jp-cli /triage') &&
        (
          github.event.repository.private == true ||
          contains(fromJSON('["OWNER", "MEMBER", "COLLABORATOR"]'), github.event.issue.author_association)
        )
      ) ||
      (
        (
          github.event_name == 'issue_comment' ||
          github.event_name == 'pull_request_review_comment'
        ) &&
        contains(github.event.comment.body, '@gemini-jp-cli') &&
        !contains(github.event.comment.body, '@gemini-jp-cli /review') &&
        !contains(github.event.comment.body, '@gemini-jp-cli /triage') &&
        (
          github.event.repository.private == true ||
          contains(fromJSON('["OWNER", "MEMBER", "COLLABORATOR"]'), github.event.comment.author_association)
        )
      ) ||
      (
        github.event_name == 'pull_request_review' &&
        contains(github.event.review.body, '@gemini-jp-cli') &&
        !contains(github.event.review.body, '@gemini-jp-cli /review') &&
        !contains(github.event.review.body, '@gemini-jp-cli /triage') &&
        (
          github.event.repository.private == true ||
          contains(fromJSON('["OWNER", "MEMBER", "COLLABORATOR"]'), github.event.review.author_association)
        )
      )
    timeout-minutes: 10
    runs-on: 'ubuntu-latest'
    steps:
      - name: 'GitHub App ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ'
        id: 'generate_token'
        if: |-
          ${{ vars.APP_ID }}
        uses: 'actions/create-github-app-token@df432ceedc7162793a195dd1713ff69aefc7379e' # ratchet:actions/create-github-app-token@v2
        with:
          app-id: '${{ vars.APP_ID }}'
          private-key: '${{ secrets.APP_PRIVATE_KEY }}'

      - name: 'ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—'
        id: 'get_context'
        env:
          EVENT_NAME: '${{ github.event_name }}'
          EVENT_PAYLOAD: '${{ toJSON(github.event) }}'
        run: |-
          set -euo pipefail

          USER_REQUEST=""
          ISSUE_NUMBER=""
          IS_PR="false"

          if [[ "${EVENT_NAME}" == "issues" ]]; then
            USER_REQUEST=$(echo "${EVENT_PAYLOAD}" | jq -r .issue.body)
            ISSUE_NUMBER=$(echo "${EVENT_PAYLOAD}" | jq -r .issue.number)
          elif [[ "${EVENT_NAME}" == "issue_comment" ]]; then
            USER_REQUEST=$(echo "${EVENT_PAYLOAD}" | jq -r .comment.body)
            ISSUE_NUMBER=$(echo "${EVENT_PAYLOAD}" | jq -r .issue.number)
            if [[ $(echo "${EVENT_PAYLOAD}" | jq -r .issue.pull_request) != "null" ]]; then
              IS_PR="true"
            fi
          elif [[ "${EVENT_NAME}" == "pull_request_review" ]]; then
            USER_REQUEST=$(echo "${EVENT_PAYLOAD}" | jq -r .review.body)
            ISSUE_NUMBER=$(echo "${EVENT_PAYLOAD}" | jq -r .pull_request.number)
            IS_PR="true"
          elif [[ "${EVENT_NAME}" == "pull_request_review_comment" ]]; then
            USER_REQUEST=$(echo "${EVENT_PAYLOAD}" | jq -r .comment.body)
            ISSUE_NUMBER=$(echo "${EVENT_PAYLOAD}" | jq -r .pull_request.number)
            IS_PR="true"
          fi

          # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
          USER_REQUEST=$(echo "${USER_REQUEST}" | sed 's/.*@gemini-jp-cli//' | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')

          # GITHUB_OUTPUTã¸ã®æ›¸ãè¾¼ã¿ã‚’heredocå½¢å¼ã«å¤‰æ›´ã—ã¦ã€ç‰¹æ®Šæ–‡å­—ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ã‚’å›é¿
          {
            echo 'user_request<<EOF'
            echo "${USER_REQUEST}"
            echo 'EOF'
            echo "issue_number=${ISSUE_NUMBER}"
            echo "is_pr=${IS_PR}"
          } >> "${GITHUB_OUTPUT}"

      - name: 'ã‚³ãƒŸãƒƒãƒˆç”¨ã®gitãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¨­å®š'
        run: |-
          git config --global user.name 'gemini-cli-jp[bot]'
          git config --global user.email 'gemini-cli-jp[bot]@users.noreply.github.com'

      - name: 'PRãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ'
        if: |-
          ${{  steps.get_context.outputs.is_pr == 'true' }}
        uses: 'actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683' # ratchet:actions/checkout@v4
        with:
          token: '${{ steps.generate_token.outputs.token || secrets.GITHUB_TOKEN }}'
          repository: '${{ github.repository }}'
          ref: 'refs/pull/${{ steps.get_context.outputs.issue_number }}/head'
          fetch-depth: 0

      - name: 'ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ'
        if: |-
          ${{  steps.get_context.outputs.is_pr == 'false' }}
        uses: 'actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683' # ratchet:actions/checkout@v4
        with:
          token: '${{ steps.generate_token.outputs.token || secrets.GITHUB_TOKEN }}'
          repository: '${{ github.repository }}'
          fetch-depth: 0

      - name: 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¢ºèª'
        env:
          GITHUB_ACTOR: '${{ github.actor }}'
          GITHUB_TOKEN: '${{ steps.generate_token.outputs.token || secrets.GITHUB_TOKEN }}'
          ISSUE_NUMBER: '${{ steps.get_context.outputs.issue_number }}'
          REPOSITORY: '${{ github.repository }}'
        run: |-
          set -euo pipefail
          MESSAGE="@${GITHUB_ACTOR} ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã¾ã—ãŸã€‚ä»Šã‹ã‚‰ä½œæ¥­ã‚’é–‹å§‹ã—ã¾ã™ï¼ ğŸ¤–"
          if [[ -n "${MESSAGE}" ]]; then
            gh issue comment "${ISSUE_NUMBER}" \
              --body "${MESSAGE}" \
              --repo "${REPOSITORY}"
          fi

      - name: 'èª¬æ˜ã‚’å–å¾—'
        id: 'get_description'
        env:
          GITHUB_TOKEN: '${{ steps.generate_token.outputs.token || secrets.GITHUB_TOKEN }}'
          IS_PR: '${{ steps.get_context.outputs.is_pr }}'
          ISSUE_NUMBER: '${{ steps.get_context.outputs.issue_number }}'
        run: |-
          set -euo pipefail
          if [[ "${IS_PR}" == "true" ]]; then
            DESCRIPTION=$(gh pr view "${ISSUE_NUMBER}" --json body --template '{{.body}}')
          else
            DESCRIPTION=$(gh issue view "${ISSUE_NUMBER}" --json body --template '{{.body}}')
          fi
          {
            echo "description<<EOF"
            echo "${DESCRIPTION}"
            echo "EOF"
          } >> "${GITHUB_OUTPUT}"

      - name: 'ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—'
        id: 'get_comments'
        env:
          GITHUB_TOKEN: '${{ steps.generate_token.outputs.token || secrets.GITHUB_TOKEN }}'
          IS_PR: '${{ steps.get_context.outputs.is_pr }}'
          ISSUE_NUMBER: '${{ steps.get_context.outputs.issue_number }}'
        run: |-
          set -euo pipefail
          if [[ "${IS_PR}" == "true" ]]; then
            COMMENTS=$(gh pr view "${ISSUE_NUMBER}" --json comments --template '{{range .comments}}{{.author.login}}: {{.body}}{{"\n"}}{{end}}')
          else
            COMMENTS=$(gh issue view "${ISSUE_NUMBER}" --json comments --template '{{range .comments}}{{.author.login}}: {{.body}}{{"\n"}}{{end}}')
          fi
          {
            echo "comments<<EOF"
            echo "${COMMENTS}"
            echo "EOF"
          } >> "${GITHUB_OUTPUT}"

      - name: 'Geminiã‚’å®Ÿè¡Œ'
        id: 'run_gemini'
        uses: 'google-github-actions/run-gemini-cli@v0'
        env:
          GITHUB_TOKEN: '${{ steps.generate_token.outputs.token || secrets.GITHUB_TOKEN }}'
          REPOSITORY: '${{ github.repository }}'
          USER_REQUEST: '${{ steps.get_context.outputs.user_request }}'
          ISSUE_NUMBER: '${{ steps.get_context.outputs.issue_number }}'
          IS_PR: '${{ steps.get_context.outputs.is_pr }}'
        with:
          gemini_api_key: '${{ secrets.GEMINI_API_KEY }}'
          gcp_workload_identity_provider: '${{ vars.GCP_WIF_PROVIDER }}'
          gcp_project_id: '${{ vars.GOOGLE_CLOUD_PROJECT }}'
          gcp_location: '${{ vars.GOOGLE_CLOUD_LOCATION }}'
          gcp_service_account: '${{ vars.SERVICE_ACCOUNT_EMAIL }}'
          use_vertex_ai: '${{ vars.GOOGLE_GENAI_USE_VERTEXAI }}'
          use_gemini_code_assist: '${{ vars.GOOGLE_GENAI_USE_GCA }}'
          settings: |-
            {
              "debug": ${{ fromJSON(env.DEBUG || env.ACTIONS_STEP_DEBUG || false) }},
              "maxSessionTurns": 50,
              "telemetry": {
                "enabled": false,
                "target": "gcp"
              }
            }
          prompt: |-
            ## ğŸ¤– å½¹å‰²
            
            ã‚ãªãŸã¯GitHubãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®CLIã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµŒç”±ã§å‘¼ã³å‡ºã•ã‚Œã‚‹è¦ªåˆ‡ãªAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒªãƒã‚¸ãƒˆãƒªã¨ã‚„ã‚Šå–ã‚Šã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¿œç­”ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚
            
            ## ğŸ“‹ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
            
            - **ãƒªãƒã‚¸ãƒˆãƒª**: `${{ github.repository }}`
            - **ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ**: `${{ github.event_name }}`
            - **Issue/PRç•ªå·**: `${{ steps.get_context.outputs.issue_number }}`
            - **ã“ã‚Œã¯PRã§ã™ã‹ï¼Ÿ**: `${{ steps.get_context.outputs.is_pr }}`
            - **Issue/PRã®èª¬æ˜**:
            `${{ steps.get_description.outputs.description }}`
            - **ã‚³ãƒ¡ãƒ³ãƒˆ**:
            `${{ steps.get_comments.outputs.comments }}`
            
            ## ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            
            ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ä»¥ä¸‹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸï¼š
            `${{ steps.get_context.outputs.user_request }}`
            
            ## ğŸš€ Issueã€PRã‚³ãƒ¡ãƒ³ãƒˆã€è³ªå•ã¸ã®å¿œç­”æ–¹æ³•
            
            ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯3ã¤ã®ä¸»è¦ãªã‚·ãƒŠãƒªã‚ªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼š
            
            ### 1. **Issueã®ä¿®æ­£ã‚’ä½œæˆ**
               - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨é–¢é€£ã™ã‚‹Issueã¾ãŸã¯PRã®èª¬æ˜ã‚’æ³¨æ„æ·±ãèª­ã‚“ã§ãã ã•ã„ã€‚
               - åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã™ã¹ã¦ã®é–¢é€£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’åé›†ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š`gh issue view`ã€`gh pr view`ã€`gh pr diff`ã€`cat`ã€`head`ã€`tail`ï¼‰ã€‚
               - å…ˆã«é€²ã‚€å‰ã«å•é¡Œã®æ ¹æœ¬åŸå› ã‚’ç‰¹å®šã—ã¦ãã ã•ã„ã€‚
               - **ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã¨ã—ã¦è¨ˆç”»ã‚’è¡¨ç¤ºã—ç¶­æŒã—ã¦ãã ã•ã„**ï¼š
                 - æœ€åˆã«ã€Issueã¾ãŸã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«å¿…è¦ãªã‚¹ãƒ†ãƒƒãƒ—ã‚’æ¦‚èª¬ã—ã€Issueã¾ãŸã¯PRã«ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æŠ•ç¨¿ã—ã¦ãã ã•ã„ï¼ˆGitHubãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ï¼š`- [ ] ã‚¿ã‚¹ã‚¯`ï¼‰ã€‚
                 - ä¾‹ï¼š
                   ```
                   ### ğŸ“‹ è¨ˆç”»
                   - [ ] æ ¹æœ¬åŸå› ã®èª¿æŸ»
                   - [ ] `file.py`ã§ã®ä¿®æ­£ã®å®Ÿè£…
                   - [ ] ãƒ†ã‚¹ãƒˆã®è¿½åŠ /ä¿®æ­£
                   - [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
                   - [ ] ä¿®æ­£ã®ç¢ºèªã¨Issueã®ã‚¯ãƒ­ãƒ¼ã‚º
                   ```
                 - ä½¿ç”¨ï¼š`gh pr comment "${ISSUE_NUMBER}" --body "<plan>"`ã¾ãŸã¯`gh issue comment "${ISSUE_NUMBER}" --body "<plan>"`ã§åˆæœŸè¨ˆç”»ã‚’æŠ•ç¨¿ã€‚
                 - é€²æ—ã«å¿œã˜ã¦ã€åŒã˜ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç·¨é›†ã—ã¦ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æœ€æ–°ã‹ã¤è¦‹ã‚„ã™ãä¿ã£ã¦ãã ã•ã„ï¼ˆå®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯ã«`- [x]`ã‚’ãƒã‚§ãƒƒã‚¯ï¼‰ã€‚
                   - ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã™ã‚‹ã«ã¯ï¼š
                     1. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’è¦‹ã¤ã‘ã¾ã™ï¼ˆ`gh pr comment list "${ISSUE_NUMBER}"`ã¾ãŸã¯`gh issue comment list "${ISSUE_NUMBER}"`ã‚’ä½¿ç”¨ï¼‰ã€‚
                     2. æ›´æ–°ã•ã‚ŒãŸãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç·¨é›†ã—ã¾ã™ï¼š
                        - PRã®å ´åˆï¼š`gh pr comment --edit <comment-id> --body "<updated plan>"`
                        - Issueã®å ´åˆï¼š`gh issue comment --edit <comment-id> --body "<updated plan>"`
                     3. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã¯Issueã¾ãŸã¯PRã®ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ã®ã¿ç¶­æŒã•ã‚Œã‚‹ã¹ãã§ã™ã€‚ã‚³ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’è¿½è·¡ã¾ãŸã¯æ›´æ–°ã—ãªã„ã§ãã ã•ã„ã€‚
               - ä¿®æ­£ã«ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯ã€å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¨è¡Œã‚’ç‰¹å®šã—ã¦ãã ã•ã„ã€‚æ˜ç¢ºåŒ–ãŒå¿…è¦ãªå ´åˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®è³ªå•ã‚’ãƒ¡ãƒ¢ã—ã¦ãã ã•ã„ã€‚
               - åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«ï¼ˆä¾‹ï¼š`write_file`ï¼‰ã‚’ä½¿ç”¨ã—ã¦å¿…è¦ãªã‚³ãƒ¼ãƒ‰ã¾ãŸã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å¤‰æ›´ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚ã™ã¹ã¦ã®å¤‰æ›´ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¦ç´„ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å¾“ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ã€ã™ã¹ã¦ã®ã‚·ã‚§ãƒ«å¤‰æ•°ã‚’`"${VAR}"`ï¼ˆå¼•ç”¨ç¬¦ã¨æ³¢æ‹¬å¼§ä»˜ãï¼‰ã¨ã—ã¦å‚ç…§ã—ã¦ãã ã•ã„ã€‚
               - ä¿®æ­£ãŒæ„å›³é€šã‚Šã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€é–¢é€£ã™ã‚‹ãƒ†ã‚¹ãƒˆã¾ãŸã¯ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚å¯èƒ½ã§ã‚ã‚Œã°ã€IssueãŒè§£æ±ºã•ã‚ŒãŸã¨ã„ã†è¨¼æ‹ ï¼ˆãƒ†ã‚¹ãƒˆå‡ºåŠ›ã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãªã©ï¼‰ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚
               - **ãƒ–ãƒ©ãƒ³ãƒä½œæˆã¨ã‚³ãƒŸãƒƒãƒˆ**ï¼š
                 - **æ±ºã—ã¦`main`ãƒ–ãƒ©ãƒ³ãƒã«ç›´æ¥ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã§ãã ã•ã„ã€‚**
                 - **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ï¼ˆ`IS_PR`ãŒ`true`ï¼‰ã§ä½œæ¥­ã—ã¦ã„ã‚‹å ´åˆã€æ­£ã—ã„ãƒ–ãƒ©ãƒ³ãƒã¯æ—¢ã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚å˜ç´”ã«ã‚³ãƒŸãƒƒãƒˆã—ã¦ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ãã ã•ã„ã€‚
                   - `git add .`
                   - `git commit -m "âœ¨ feat: <å¤‰æ›´ã®èª¬æ˜>"`
                   - `git push`
                 - **Issue**ï¼ˆ`IS_PR`ãŒ`false`ï¼‰ã§ä½œæ¥­ã—ã¦ã„ã‚‹å ´åˆã€å¤‰æ›´ã®ãŸã‚ã®æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚é©åˆ‡ãªãƒ–ãƒ©ãƒ³ãƒåã¯`issue/${ISSUE_NUMBER}/<çŸ­ã„èª¬æ˜>`ã§ã™ã€‚
                   - `git checkout -b issue/${ISSUE_NUMBER}/my-fix`
                   - `git add .`
                   - `git commit -m "âœ¨ feat: <ä¿®æ­£ã®èª¬æ˜>"`
                   - `git push origin issue/${ISSUE_NUMBER}/my-fix`
                   - ãƒ—ãƒƒã‚·ãƒ¥å¾Œã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã§ãã¾ã™ï¼š`gh pr create --title "ğŸ”§ Fixes #${ISSUE_NUMBER}: <çŸ­ã„ã‚¿ã‚¤ãƒˆãƒ«>" --body "âœ¨ ã“ã®PRã¯Issue #${ISSUE_NUMBER}ã«å¯¾å‡¦ã—ã¾ã™ã€‚"`
               - ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã§ä½•ãŒå¤‰æ›´ã•ã‚Œã€ãã®ç†ç”±ã‚’è¦ç´„ã—ã¦ãã ã•ã„ï¼š`write_file("response.md", "<ã“ã“ã«ã‚ãªãŸã®å¿œç­”>")`
               - å¿œç­”ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æŠ•ç¨¿ï¼š
                 - PRã®å ´åˆï¼š`gh pr comment "${ISSUE_NUMBER}" --body-file response.md`
                 - Issueã®å ´åˆï¼š`gh issue comment "${ISSUE_NUMBER}" --body-file response.md`
            
            ### 2. **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚³ãƒ¡ãƒ³ãƒˆã«å¯¾å‡¦**
               - ç‰¹å®šã®ã‚³ãƒ¡ãƒ³ãƒˆã¨PRã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã‚“ã§ãã ã•ã„ã€‚
               - `gh pr view`ã€`gh pr diff`ã€`cat`ãªã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‰ã¨è­°è«–ã‚’ç†è§£ã—ã¦ãã ã•ã„ã€‚
               - ã‚³ãƒ¡ãƒ³ãƒˆãŒå¤‰æ›´ã‚„æ˜ç¢ºåŒ–ã‚’æ±‚ã‚ã¦ã„ã‚‹å ´åˆã€Issueã®ä¿®æ­£ã¨åŒã˜ãƒ—ãƒ­ã‚»ã‚¹ã«å¾“ã£ã¦ãã ã•ã„ï¼šãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè¨ˆç”»ã‚’ä½œæˆã—ã€å®Ÿè£…ã—ã€ãƒ†ã‚¹ãƒˆã—ã€å¿…è¦ãªå¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã€é€²è¡Œã«å¿œã˜ã¦ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚
               - **å¤‰æ›´ã®ã‚³ãƒŸãƒƒãƒˆ**ï¼šæ­£ã—ã„PRãƒ–ãƒ©ãƒ³ãƒã¯æ—¢ã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚å˜ç´”ã«å¤‰æ›´ã‚’è¿½åŠ ã€ã‚³ãƒŸãƒƒãƒˆã€ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ãã ã•ã„ã€‚
                 - `git add .`
                 - `git commit -m "ğŸ”§ fix: ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã«å¯¾å‡¦"`
                 - `git push`
               - ã‚³ãƒ¡ãƒ³ãƒˆãŒè³ªå•ã®å ´åˆã€å¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ¼ãƒ‰ã¾ãŸã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ã€ç›´æ¥çš„ã‹ã¤æ˜ç¢ºã«ç­”ãˆã¦ãã ã•ã„ã€‚
               - `response.md`ã§å¿œç­”ã‚’æ–‡æ›¸åŒ–ã—ã€PRã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æŠ•ç¨¿ï¼š`gh pr comment "${ISSUE_NUMBER}" --body-file response.md`
            
            ### 3. **Issueã®ä»»æ„ã®è³ªå•ã«ç­”ãˆã‚‹**
               - `gh issue view`ãŠã‚ˆã³é–¢é€£ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€è³ªå•ã¨å®Œå…¨ãªIssueã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã‚“ã§ãã ã•ã„ã€‚
               - æ­£ç¢ºãªå›ç­”ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ã€å¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’ç ”ç©¶ã¾ãŸã¯åˆ†æã—ã¦ãã ã•ã„ã€‚
               - è³ªå•ã«ã‚³ãƒ¼ãƒ‰ã¾ãŸã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã€ä¸Šè¨˜ã®ä¿®æ­£ãƒ—ãƒ­ã‚»ã‚¹ã«å¾“ã„ã€ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè¨ˆç”»ã®ä½œæˆã¨æ›´æ–°ã€ãŠã‚ˆã³**ã‚»ã‚¯ã‚·ãƒ§ãƒ³1ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹å¤‰æ›´ã®ãŸã‚ã®æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã®ä½œæˆ**ã‚’å«ã‚ã¦ãã ã•ã„ã€‚
               - `response.md`ã§æ˜ç¢ºã§ç°¡æ½”ãªå›ç­”ã‚’æ›¸ãã€Issueã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æŠ•ç¨¿ï¼š`gh issue comment "${ISSUE_NUMBER}" --body-file response.md`
            
            ## ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
            
            - **ç°¡æ½”ã§å®Ÿè¡Œå¯èƒ½ã§ã‚ã‚‹ã“ã¨ã€‚** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å•é¡Œã‚’åŠ¹ç‡çš„ã«è§£æ±ºã™ã‚‹ã“ã¨ã«ç„¦ç‚¹ã‚’å½“ã¦ã¦ãã ã•ã„ã€‚
            - **ã‚³ãƒ¼ãƒ‰ã¾ãŸã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä¿®æ­£ã—ãŸå ´åˆã¯ã€å¸¸ã«å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ãã ã•ã„ã€‚**
            - **ä¿®æ­£ã‚„å›ç­”ã«ã¤ã„ã¦ä¸æ˜ãªå ´åˆã¯ã€ã‚ãªãŸã®æ¨è«–ã‚’èª¬æ˜ã—ã€æ˜ç¢ºåŒ–ã®è³ªå•ã‚’ã—ã¦ãã ã•ã„ã€‚**
            - **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¦ç´„ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å¾“ã£ã¦ãã ã•ã„ã€‚**
            - **å¿œç­”ã«ã¯é©åˆ‡ãªçµµæ–‡å­—ã‚’ä½¿ç”¨ã—ã¦ã€è¦ªã—ã¿ã‚„ã™ã„é›°å›²æ°—ã‚’ä½œã£ã¦ãã ã•ã„ã€‚** ãŸã ã—ã€éåº¦ãªä½¿ç”¨ã¯é¿ã‘ã¦ãã ã•ã„ã€‚
            - **æˆåŠŸæ™‚ã«ã¯ ğŸ‰ã€è­¦å‘Šæ™‚ã«ã¯ âš ï¸ ãªã©ã®çµµæ–‡å­—ã‚’åŠ¹æœçš„ã«ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚**
            
            ### ğŸ’¾ ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®çµµæ–‡å­—ã‚¬ã‚¤ãƒ‰
            ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ä»¥ä¸‹ã®çµµæ–‡å­—ã‚’æ´»ç”¨ã—ã¦ãã ã•ã„ï¼š
            - `âœ¨ feat:` - æ–°æ©Ÿèƒ½ã®è¿½åŠ 
            - `ğŸ”§ fix:` - ãƒã‚°ä¿®æ­£
            - `ğŸ“ docs:` - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
            - `ğŸ¨ style:` - ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´
            - `â™»ï¸ refactor:` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
            - `âœ… test:` - ãƒ†ã‚¹ãƒˆã®è¿½åŠ ãƒ»ä¿®æ­£
            - `ğŸš€ perf:` - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
            - `ğŸ”§ chore:` - ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã‚„è£œåŠ©ãƒ„ãƒ¼ãƒ«ã®å¤‰æ›´
            
            ### ğŸ”„ ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®çµµæ–‡å­—ã‚¬ã‚¤ãƒ‰
            ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ã¨èª¬æ˜ã«ã¯ä»¥ä¸‹ã®çµµæ–‡å­—ã‚’æ´»ç”¨ã—ã¦ãã ã•ã„ï¼š
            - `ğŸ”§ Fix #123:` - ãƒã‚°ä¿®æ­£PR
            - `âœ¨ Feature #123:` - æ–°æ©Ÿèƒ½PR
            - `ğŸ“ Docs #123:` - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°PR
            - `â™»ï¸ Refactor #123:` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°PR
            - `ğŸš€ Performance #123:` - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„PR
            
            ã™ã¹ã¦ã®å¿œç­”ã¨ã‚³ãƒ¡ãƒ³ãƒˆã¯æ—¥æœ¬èªã§è¡Œã£ã¦ãã ã•ã„ã€‚ğŸ‡¯ğŸ‡µ
